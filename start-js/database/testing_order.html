<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="stylesheet" href="testing_style.css">
</head>
<body>
  <div class="Orderplatform">

    <div class="img">
      <div><a href="testing.html">close</a></div>
      <div>
        <div>search</div>
        <div>more</div>
      </div>
    </div>

    <div class="order">
      <h1>STORE NAME</h1>
      <div class="menu">
        <div>
          <div>
            <h3>menu_name</h3>
            <div>單價</div>
          </div>
          <div>
            <!-- 總金額 -->
            <div>total price</div>

            <div>+</div><div>count</div><div>-</div>
          </div>
        </div>
        <div>
          <!-- 參與這個項目的人 -->
          <p>王小明</p>
          <p>王小明</p>
          <p>王小明</p>
          <p>王小明</p>
          <p>王小明</p>
          <p>王小明</p>
        </div>
      </div>
    </div>
    
    <div class="add">
      <form>
        <label for="menuName">菜色名稱</label>
        <input placeholder="menuName" type="text" id="menuName" name="menuName" autocomplete="off">
  
        <label for="foodCost">菜色單價</label>
        <input placeholder="foodCost" type="number" id="foodCost" name="foodCost" autocomplete="off">
  
        <button type="button">新增菜色</button>
      </form>
    </div>
  </div>
  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
  <script type="module">

    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js";
    import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-database.js";

    // 初始化 Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyC2wGJaAsQTdMP6VOiVtAl4DGlToiSvwSY",
      authDomain: "nomadic-bison-390822.firebaseapp.com",
      databaseURL: "https://nomadic-bison-390822-default-rtdb.asia-southeast1.firebasedatabase.app/",
      projectId: "nomadic-bison-390822",
      storageBucket: "nomadic-bison-390822.appspot.com",
      messagingSenderId: "128137030974",
      appId: "1:128137030974:web:9747a3640eae3d445cd06f",
      measurementId: "G-GN70PHQBBG"
    };
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // 讀取 cookie 的函數
    function getCookie(name) {
      const value = `; ${document.cookie}`;
      const parts = value.split(`; ${name}=`);
      if (parts.length === 2) return parts.pop().split(';').shift();
      return null;
    }

    // DOM 加載完成後的事件處理
    document.addEventListener("DOMContentLoaded", function() {
      const restaurantName = getCookie("selectedRestaurantName");

      // 更新頁面標題
      if (restaurantName !== null) {
        document.querySelector(".order > h1").innerText = restaurantName;
      }

      // 從 Firebase 讀取對應餐廳的圖片 URL
      const dbRef = ref(db, `/restaurant/${restaurantName}`);

      // 抓取數據
      get(dbRef).then((snapshot) => {
        if (snapshot.exists()) {
          const data = snapshot.val();
          if (data && data.foodimg) {
            document.querySelector(".Orderplatform > .img").style.backgroundImage = `url('${data.foodimg}')`;
          } else {
            console.log("No data found or 'foodimg' field is missing.");
          }
        } else {
          console.log("No data available");
        }
      }).catch((error) => {
        console.error(`Failed to fetch data: ${error}`);
      });
    });

  </script>
</body>
</html>